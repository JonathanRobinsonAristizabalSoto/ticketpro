-- Eliminar la base de datos si existe
DROP DATABASE IF EXISTS `ticketpro`;

-- Crear la base de datos
CREATE DATABASE IF NOT EXISTS `ticketpro`;
USE `ticketpro`;

-- Estructura de tabla para la tabla `Rol`
CREATE TABLE Rol (
    id_rol INT PRIMARY KEY AUTO_INCREMENT,
    nombre_rol VARCHAR(255) NOT NULL,
    descripcion_rol TEXT,
    UNIQUE (nombre_rol)
);

-- Estructura de tabla para la tabla `Usuarios`
CREATE TABLE Usuarios (
    id_usuario INT PRIMARY KEY AUTO_INCREMENT,
    tipo_documento VARCHAR(255) NOT NULL,
    documento VARCHAR(255) NOT NULL UNIQUE,
    nombre VARCHAR(255) NOT NULL,
    apellido VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL UNIQUE,
    telefono VARCHAR(20),
    departamento VARCHAR(255),
    municipio VARCHAR(255),
    password VARCHAR(255) NOT NULL,
    id_rol INT,
    fecha_registro DATE,
    estado VARCHAR(50),
    FOREIGN KEY (id_rol) REFERENCES Rol(id_rol),
    INDEX (email),
    INDEX (documento)
);

-- Estructura de tabla para la tabla `Programas`
CREATE TABLE Programas (
    id_programa INT PRIMARY KEY AUTO_INCREMENT,
    codigo VARCHAR(50) NOT NULL,
    version VARCHAR(50) NOT NULL,
    tipo_de_formacion VARCHAR(255) NOT NULL,
    nombre VARCHAR(255) NOT NULL,
    descripcion TEXT,
    nivel_de_formacion VARCHAR(255) NOT NULL,
    duracion INT NOT NULL,
    linea_tecnologica VARCHAR(255) NOT NULL,
    red_tecnologica VARCHAR(255) NOT NULL,
    red_de_conocimiento VARCHAR(255) NOT NULL,
    modalidad VARCHAR(255) NOT NULL,
    UNIQUE (nombre)
);

-- Estructura de tabla para la tabla `Ticket`
CREATE TABLE Ticket (
    id_ticket INT PRIMARY KEY AUTO_INCREMENT,
    id_usuario INT,
    numero_ticket VARCHAR(6) NOT NULL UNIQUE,
    tipo_de_solicitud VARCHAR(50),
    titulo VARCHAR(255) NOT NULL,
    descripcion TEXT,
    prioridad VARCHAR(50),
    estado VARCHAR(50),
    id_agente INT,
    fecha_creacion DATE,
    fecha_actualizacion DATE,
    id_programa INT,
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario),
    FOREIGN KEY (id_programa) REFERENCES Programas(id_programa),
    INDEX (id_usuario),
    INDEX (id_programa)
);

-- Estructura de tabla para la tabla `Comentario`
CREATE TABLE Comentario (
    id_comentario INT PRIMARY KEY AUTO_INCREMENT,
    id_ticket INT,
    id_usuario INT,
    comentario TEXT NOT NULL,
    fecha_comentario DATE,
    FOREIGN KEY (id_ticket) REFERENCES Ticket(id_ticket),
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario),
    INDEX (id_ticket),
    INDEX (id_usuario)
);

-- Estructura de tabla para la tabla `Evento`
CREATE TABLE Evento (
    id_evento INT PRIMARY KEY AUTO_INCREMENT,
    id_ticket INT,
    accion VARCHAR(255) NOT NULL,
    id_usuario INT,
    fecha_evento DATE,
    FOREIGN KEY (id_ticket) REFERENCES Ticket(id_ticket),
    FOREIGN KEY (id_usuario) REFERENCES Usuarios(id_usuario),
    INDEX (id_ticket),
    INDEX (id_usuario)
);

-- Volcado de datos para la tabla `Rol`
INSERT INTO Rol (id_rol, nombre_rol, descripcion_rol) VALUES
(1, 'Administrador', NULL),
(2, 'Usuario', NULL);

-- Volcado de datos para la tabla `Usuarios`
INSERT INTO Usuarios (id_usuario, tipo_documento, documento, nombre, apellido, email, telefono, departamento, municipio, password, id_rol, fecha_registro, estado) VALUES
(1, 'CC', '1053810807', 'Jonathan Robinson', 'Aristizabal Soto', 'admin@gmail.com', '3187542709', 'Caldas', 'Manizales', '$2y$10$DZZkPzlQlZzEtlyyIdPFju3WGm8mUsLRKRna6qpu.9I5zUgm.8HtG', 1, '2024-09-07', 'activo'),
(2, 'CC', '87654321', 'María', 'Gómez', 'maria.gomez@example.com', '3201234567', 'Antioquia', 'Medellín', 'password123', 2, '2023-10-01', 'activo'),
(3, 'CC', '11223344', 'Carlos', 'López', 'carlos.lopez@example.com', '3109876543', 'Bogotá', 'Bogotá', 'password123', 2, '2023-10-02', 'activo'),
(4, 'CC', '44332211', 'Ana', 'Martínez', 'ana.martinez@example.com', '3001239876', 'Valle del Cauca', 'Cali', 'password123', 2, '2023-10-03', 'activo'),
(5, 'CC', '55667788', 'Luis', 'Rodríguez', 'luis.rodriguez@example.com', '3112233445', 'Santander', 'Bucaramanga', 'password123', 2, '2023-10-04', 'activo');

-- Volcado de datos para la tabla `Programas`
INSERT INTO Programas (codigo, version, tipo_de_formacion, nombre, nivel_de_formacion, duracion, linea_tecnologica, red_tecnologica, red_de_conocimiento, modalidad, descripcion) VALUES
('22620442', '3', 'Complementaria', 'BASICO OPERATIVO TRABAJO SEGURO EN ALTURAS', 'Curso especial', 8, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620443', '2', 'Complementaria', 'ADMINISTRATIVO  PARA JEFES DE AREA TRABAJO SEGURO EN ALTURAS', 'Curso especial', 10, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620444', '3', 'Complementaria', 'COORDINADOR DE TRABAJO SEGURO EN ALTURAS.', 'Curso especial', 80, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620461', '2', 'Complementaria', 'RESCATE INDUSTRIAL EN TRABAJO EN ALTURAS', 'Curso especial', 48, 'PRODUCCIÓN Y TRANSFORMACIÓN', 'TECNOLOGÍAS DE PRODUCCIÓN INDUSTRIAL', 'Infraestructura', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620489', '1', 'Complementaria', 'TRABAJADOR AUTORIZADO PARA TRABAJO EN ALTURAS', 'Curso especial', 32, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620490', '1', 'Complementaria', 'COORDINADOR DE TRABAJO EN ALTURAS', 'Curso especial', 80, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620491', '1', 'Complementaria', 'REENTRENAMIENTO EN TRABAJO EN ALTURAS PARA TRABAJADOR AUTORIZADO', 'Curso especial', 16, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620492', '1', 'Complementaria', 'ACTUALIZACION DE COORDINADORES PARA TRABAJO EN ALTURAS', 'Curso especial', 16, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620493', '1', 'Complementaria', 'ACTUALIZACION DE ENTRENADORES PARA TRABAJO EN ALTURAS', 'Curso especial', 32, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620494', '1', 'Complementaria', 'ENTRENADOR PARA TRABAJO EN ALTURAS', 'Curso especial', 130, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620495', '1', 'Complementaria', 'FORMADOR DE ENTRENADORES PARA TRABAJO EN ALTURAS', 'Curso especial', 48, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('22620496', '1', 'Complementaria', 'JEFES DE AREA PARA TRABAJO EN ALTURAS', 'Curso especial', 8, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('41311191', '1', 'Complementaria', 'INSPECTOR DE CENTROS DE FORMACION Y ENTRENAMIENTO PARA TRABAJO EN ALTURAS Y ESPACIOS CONFINADOS', 'Curso especial', 48, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.'),
('86110513', '2', 'Complementaria', 'ACONDICIONAMIENTO DE ANDAMIOS PARA TRABAJO EN ALTURAS', 'Curso especial', 48, 'MATERIALES HERRAMIENTAS', 'MATERIALES PARA LA CONSTRUCCIÓN', 'Construcción', 'Presencial', 'Capacitación para trabajos en altura.');

-- Volcado de datos para la tabla `Ticket`
INSERT INTO Ticket (id_ticket, id_usuario, numero_ticket, tipo_de_solicitud, titulo, descripcion, prioridad, estado, id_agente, fecha_creacion, fecha_actualizacion, id_programa) VALUES
(1, 1, 'A1B2C3', 'Formacion', 'Asignación de cupos para curso BASICO OPERATIVO TRABAJO SEGURO EN ALTURAS', 'Necesito 5 cupos para el curso básico de formación.', 'Alta', 'abierto', NULL, '2023-10-01', '2023-10-01', 1),
(2, 2, 'D4E5F6', 'Consulta', 'Consulta sobre programa ADMINISTRATIVO PARA JEFES DE AREA TRABAJO SEGURO EN ALTURAS', 'Solicito información sobre el programa avanzado de formación.', 'Media', 'cerrado', NULL, '2023-10-02', '2023-10-02', 2),
(3, 3, 'G7H8I9', 'Certificacion', 'Certificación de competencias laborales en COORDINADOR DE TRABAJO SEGURO EN ALTURAS', 'Necesito certificar mis competencias laborales en el área de seguridad.', 'Alta', 'resuelto', NULL, '2023-10-03', '2023-10-03', 3),
(4, 4, 'J1K2L3', 'Formacion', 'Asignación de cupos para curso avanzado RESCATE INDUSTRIAL EN TRABAJO EN ALTURAS', 'Necesito 3 cupos para el curso avanzado de formación.', 'Alta', 'abierto', NULL, '2023-10-04', '2023-10-04', 4),
(5, 5, 'M4N5O6', 'Consulta', 'Consulta sobre requisitos de inscripción para TRABAJADOR AUTORIZADO PARA TRABAJO EN ALTURAS', 'Solicito información sobre los requisitos de inscripción para el curso.', 'Media', 'cerrado', NULL, '2023-10-05', '2023-10-05', 5),
(6, 1, 'P7Q8R9', 'Certificacion', 'Certificación de habilidades técnicas en COORDINADOR DE TRABAJO EN ALTURAS', 'Necesito certificar mis habilidades técnicas en el área de programación.', 'Alta', 'progreso', NULL, '2023-10-06', '2023-10-06', 6),
(7, 2, 'S1T2U3', 'Formacion', 'Asignación de cupos para taller práctico REENTRENAMIENTO EN TRABAJO EN ALTURAS PARA TRABAJADOR AUTORIZADO', 'Necesito 4 cupos para el taller práctico de formación.', 'Alta', 'abierto', NULL, '2023-10-07', '2023-10-07', 7),
(8, 3, 'V4W5X6', 'Consulta', 'Consulta sobre horarios de clases para ACTUALIZACION DE COORDINADORES PARA TRABAJO EN ALTURAS', 'Solicito información sobre los horarios de las clases del curso.', 'Media', 'cerrado', NULL, '2023-10-08', '2023-10-08', 8),
(9, 4, 'Y7Z8A9', 'Certificacion', 'Certificación de competencias en liderazgo en ACTUALIZACION DE ENTRENADORES PARA TRABAJO EN ALTURAS', 'Necesito certificar mis competencias en liderazgo y gestión de equipos.', 'Alta', 'progreso', NULL, '2023-10-09', '2023-10-09', 9),
(10, 5, 'B1C2D3', 'Formacion', 'Asignación de cupos para seminario ENTRENADOR PARA TRABAJO EN ALTURAS', 'Necesito 2 cupos para el seminario de formación.', 'Alta', 'abierto', NULL, '2023-10-10', '2023-10-10', 10),
(11, 1, 'E4F5G6', 'Consulta', 'Consulta sobre materiales de estudio para FORMADOR DE ENTRENADORES PARA TRABAJO EN ALTURAS', 'Solicito información sobre los materiales de estudio proporcionados en el curso.', 'Media', 'cerrado', NULL, '2023-10-11', '2023-10-11', 11),
(12, 2, 'H7I8J9', 'Certificacion', 'Certificación de competencias en gestión de proyectos en JEFES DE AREA PARA TRABAJO EN ALTURAS', 'Necesito certificar mis competencias en gestión de proyectos.', 'Alta', 'progreso', NULL, '2023-10-12', '2023-10-12', 12),
(13, 3, 'K1L2M3', 'Formacion', 'Asignación de cupos para curso intermedio INSPECTOR DE CENTROS DE FORMACION Y ENTRENAMIENTO PARA TRABAJO EN ALTURAS Y ESPACIOS CONFINADOS', 'Necesito 6 cupos para el curso intermedio de formación.', 'Alta', 'abierto', NULL, '2023-10-13', '2023-10-13', 13),
(14, 4, 'N4O5P6', 'Consulta', 'Consulta sobre evaluación del curso ACONDICIONAMIENTO DE ANDAMIOS PARA TRABAJO EN ALTURAS', 'Solicito información sobre el proceso de evaluación del curso.', 'Media', 'pendiente', NULL, '2023-10-14', '2023-10-14', 14);
-- Volcado de datos para la tabla `Comentario`
INSERT INTO Comentario (id_comentario, id_ticket, id_usuario, comentario, fecha_comentario) VALUES
(1, 1, 2, '¿Cuándo necesitan los cupos?', '2023-10-01'),
(2, 1, 1, 'Para la próxima semana. La empresa necesita capacitar a su personal para cumplir con las normativas de seguridad.', '2023-10-01'),
(3, 3, 4, '¿Cuándo podemos agendar el mantenimiento?', '2023-10-03'),
(4, 3, 3, 'Lo antes posible. Los equipos están presentando fallas y necesitamos mantener la operatividad.', '2023-10-03'),
(5, 4, 5, '¿Qué tipo de capacitación necesitan?', '2023-10-04'),
(6, 4, 4, 'Capacitación en desarrollo de aplicaciones web. La entidad está implementando un nuevo sistema.', '2023-10-04'),
(7, 5, 3, 'Podemos agendar una reunión para discutir los detalles.', '2023-10-05'),
(8, 5, 5, 'Perfecto. Necesitamos consultoría para un proyecto de transformación digital.', '2023-10-05');

-- Volcado de datos para la tabla `Evento`
INSERT INTO Evento (id_evento, id_ticket, accion, id_usuario, fecha_evento) VALUES
(1, 1, 'Creación de ticket', 1, '2023-10-01'),
(2, 1, 'Asignación de agente', 2, '2023-10-01'),
(3, 2, 'Creación de ticket', 2, '2023-10-02'),
(4, 2, 'Cierre de ticket', 1, '2023-10-02'),
(5, 3, 'Creación de ticket', 3, '2023-10-03'),
(6, 3, 'Actualización de ticket', 4, '2023-10-03'),
(7, 4, 'Creación de ticket', 4, '2023-10-04'),
(8, 4, 'Asignación de agente', 5, '2023-10-04'),
(9, 5, 'Creación de ticket', 5, '2023-10-05'),
(10, 5, 'Cierre de ticket', 3, '2023-10-05');